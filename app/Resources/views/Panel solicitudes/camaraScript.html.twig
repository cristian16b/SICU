<script>
(function() {
          var streaming = false,
              video        = document.querySelector('#video'),
              cover        = document.querySelector('#cover'),
              canvas       = document.querySelector('#canvas'),
              photo        = document.querySelector('#photo'),
              tomarfoto  = document.querySelector('#tomarfoto'),
              width = 300,
              height = 0;
          var image = document.getElementById('imagen');

          navigator.getMedia = ( navigator.getUserMedia || 
                                 navigator.webkitGetUserMedia ||
                                 navigator.mozGetUserMedia ||
                                 navigator.msGetUserMedia);

          video.addEventListener('canplay', function(ev){
            if (!streaming) {
              height = video.videoHeight / (video.videoWidth/width);
              video.setAttribute('width', width);
              video.setAttribute('height', height);

    canvas.setAttribute('width', width);
              canvas.setAttribute('height', height);
              streaming = true;
            }
          }, false);


          function takepicture(e) {


           //asigno la ruta de archivo para que se muestre

           canvas.width = width;
           canvas.height = height;
           canvas.getContext('2d').drawImage(video, 0, 0, width, height);


           //intento convertir
            var imagen = document.getElementById('imagen');
            imagen.src = canvas.toDataURL("image/png");

          }


          tomarfoto.addEventListener('click', function(ev){
              takepicture();
            ev.preventDefault();
          }, false);

})();
</script> 
